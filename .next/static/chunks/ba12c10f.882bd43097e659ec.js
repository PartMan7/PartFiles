"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8803],{7362:(e,t,a)=>{a.d(t,{qG:()=>tA,rL:()=>tM,vl:()=>tS});var r,o,s,i,n,l,p,u,d,c,m,h,v,g=a(81698),y=a(35914),z=a(69058),f=a(2818),b=Object.defineProperty,I="AI_InvalidArgumentError",E=`vercel.ai.error.${I}`,x=Symbol.for(E),w=class extends y.bD{constructor({parameter:e,value:t,message:a}){super({name:I,message:`Invalid argument for parameter ${e}: ${a}`}),this[r]=!0,this.parameter=e,this.value=t}static isInstance(e){return y.bD.hasMarker(e,E)}};r=x,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError"),y.bD;var T="AI_InvalidToolApprovalError",R=`vercel.ai.error.${T}`,N=Symbol.for(R),M=class extends y.bD{constructor({approvalId:e}){super({name:T,message:`Tool approval response references unknown approvalId: "${e}". No matching tool-approval-request found in message history.`}),this[o]=!0,this.approvalId=e}static isInstance(e){return y.bD.hasMarker(e,R)}};o=N;var S="AI_InvalidToolInputError",A=`vercel.ai.error.${S}`,C=Symbol.for(A),j=class extends y.bD{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${(0,y.u1)(a)}`}){super({name:S,message:r,cause:a}),this[s]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return y.bD.hasMarker(e,A)}};s=C;var _="AI_ToolCallNotFoundForApprovalError",k=`vercel.ai.error.${_}`,O=Symbol.for(k),D=class extends y.bD{constructor({toolCallId:e,approvalId:t}){super({name:_,message:`Tool call "${e}" not found for approval request "${t}".`}),this[i]=!0,this.toolCallId=e,this.approvalId=t}static isInstance(e){return y.bD.hasMarker(e,k)}};i=O;var P=Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");y.bD;var $="AI_NoObjectGeneratedError",F=`vercel.ai.error.${$}`,U=Symbol.for(F),L=class extends y.bD{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:o,finishReason:s}){super({name:$,message:e,cause:t}),this[n]=!0,this.text=a,this.response=r,this.usage=o,this.finishReason=s}static isInstance(e){return y.bD.hasMarker(e,F)}};n=U;var q="AI_NoOutputGeneratedError",B=`vercel.ai.error.${q}`,W=Symbol.for(B),J=class extends y.bD{constructor({message:e="No output generated.",cause:t}={}){super({name:q,message:e,cause:t}),this[l]=!0}static isInstance(e){return y.bD.hasMarker(e,B)}};l=W,y.bD;var V="AI_NoSuchToolError",G=`vercel.ai.error.${V}`,Y=Symbol.for(G),K=class extends y.bD{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:V,message:a}),this[p]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return y.bD.hasMarker(e,G)}};p=Y;var Z="AI_ToolCallRepairError",H=`vercel.ai.error.${Z}`,Q=Symbol.for(H),X=class extends y.bD{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,y.u1)(e)}`}){super({name:Z,message:a,cause:e}),this[u]=!0,this.originalError=t}static isInstance(e){return y.bD.hasMarker(e,H)}};u=Q;var ee=class extends y.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},et="AI_InvalidDataContentError",ea=`vercel.ai.error.${et}`,er=Symbol.for(ea);y.bD,d=er;var eo="AI_InvalidMessageRoleError",es=`vercel.ai.error.${eo}`,ei=Symbol.for(es),en=class extends y.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:eo,message:t}),this[c]=!0,this.role=e}static isInstance(e){return y.bD.hasMarker(e,es)}};c=ei;var el="AI_MessageConversionError",ep=`vercel.ai.error.${el}`,eu=Symbol.for(ep),ed=class extends y.bD{constructor({originalMessage:e,message:t}){super({name:el,message:t}),this[m]=!0,this.originalMessage=e}static isInstance(e){return y.bD.hasMarker(e,ep)}};m=eu;var ec="AI_RetryError",em=`vercel.ai.error.${ec}`,eh=Symbol.for(em),ev=class extends y.bD{constructor({message:e,reason:t,errors:a}){super({name:ec,message:e}),this[h]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return y.bD.hasMarker(e,em)}};h=eh;var eg=!1,ey=e=>{if(0===e.warnings.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t){t(e);return}for(let t of(eg||(eg=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e.warnings))console.warn(function({warning:e,provider:t,model:a}){let r=`AI SDK Warning (${t} / ${a}):`;switch(e.type){case"unsupported":{let t=`${r} The feature "${e.feature}" is not supported.`;return e.details&&(t+=` ${e.details}`),t}case"compatibility":{let t=`${r} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(t+=` ${e.details}`),t}case"other":return`${r} ${e.message}`;default:return`${r} ${JSON.stringify(e,null,2)}`}}({warning:t,provider:e.provider,model:e.model}))}};function ez({provider:e,modelId:t}){ey({warnings:[{type:"compatibility",feature:"specificationVersion",details:"Using v2 specification compatibility mode. Some features may not be available."}],provider:e,model:t})}function ef(e){return{unified:"unknown"===e?"other":e,raw:void 0}}function eb(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}var eI=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],eE=e=>{let t="string"==typeof e?convertBase64ToUint8Array(e):e,a=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(a+10)},ex="6.0.33",ew=async({url:e})=>{var t;let a=e.toString();try{let e=await fetch(a,{headers:withUserAgentSuffix({},`ai-sdk/${ex}`,getRuntimeEnvironmentUserAgent())});if(!e.ok)throw new DownloadError2({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(DownloadError2.isInstance(e))throw e;throw new DownloadError2({url:a,cause:e})}},eT=(e=ew)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))),eR=z.z.union([z.z.string(),z.z.instanceof(Uint8Array),z.z.instanceof(ArrayBuffer),z.z.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function eN(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new AISDKError18({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}function eM(e){return void 0===e?[]:Array.isArray(e)?e:[e]}async function eS(e,t,a){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,r="image"===e.type?e.image:e.data;if("string"==typeof r)try{r=new URL(r)}catch(e){}return{mediaType:a,data:r}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&isUrlSupported({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})}));return Object.fromEntries((await t(r)).map((e,t)=>null==e?null:[r[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}function eA(e){return"content"!==e.type?e:{type:"content",value:e.value.map(e=>"media"!==e.type?e:e.mediaType.startsWith("image/")?{type:"image-data",data:e.data,mediaType:e.mediaType}:{type:"file-data",data:e.data,mediaType:e.mediaType})}}async function eC({toolCallId:e,input:t,output:a,tool:r,errorMode:o}){return"text"===o?{type:"error-text",value:getErrorMessage3(a)}:"json"===o?{type:"error-json",value:ej(a)}:(null==r?void 0:r.toModelOutput)?await r.toModelOutput({toolCallId:e,input:t,output:a}):"string"==typeof a?{type:"text",value:a}:{type:"json",value:ej(a)}}function ej(e){return void 0===e?null:e}var e_=z.z.lazy(()=>z.z.union([z.z.null(),z.z.string(),z.z.number(),z.z.boolean(),z.z.record(z.z.string(),e_.optional()),z.z.array(e_)])),ek=z.z.record(z.z.string(),z.z.record(z.z.string(),e_.optional())),eO=z.z.object({type:z.z.literal("text"),text:z.z.string(),providerOptions:ek.optional()}),eD=z.z.object({type:z.z.literal("image"),image:z.z.union([eR,z.z.instanceof(URL)]),mediaType:z.z.string().optional(),providerOptions:ek.optional()}),eP=z.z.object({type:z.z.literal("file"),data:z.z.union([eR,z.z.instanceof(URL)]),filename:z.z.string().optional(),mediaType:z.z.string(),providerOptions:ek.optional()}),e$=z.z.object({type:z.z.literal("reasoning"),text:z.z.string(),providerOptions:ek.optional()}),eF=z.z.object({type:z.z.literal("tool-call"),toolCallId:z.z.string(),toolName:z.z.string(),input:z.z.unknown(),providerOptions:ek.optional(),providerExecuted:z.z.boolean().optional()}),eU=z.z.discriminatedUnion("type",[z.z.object({type:z.z.literal("text"),value:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("json"),value:e_,providerOptions:ek.optional()}),z.z.object({type:z.z.literal("execution-denied"),reason:z.z.string().optional(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("error-text"),value:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("error-json"),value:e_,providerOptions:ek.optional()}),z.z.object({type:z.z.literal("content"),value:z.z.array(z.z.union([z.z.object({type:z.z.literal("text"),text:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("media"),data:z.z.string(),mediaType:z.z.string()}),z.z.object({type:z.z.literal("file-data"),data:z.z.string(),mediaType:z.z.string(),filename:z.z.string().optional(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("file-url"),url:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("file-id"),fileId:z.z.union([z.z.string(),z.z.record(z.z.string(),z.z.string())]),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("image-data"),data:z.z.string(),mediaType:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("image-url"),url:z.z.string(),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("image-file-id"),fileId:z.z.union([z.z.string(),z.z.record(z.z.string(),z.z.string())]),providerOptions:ek.optional()}),z.z.object({type:z.z.literal("custom"),providerOptions:ek.optional()})]))})]),eL=z.z.object({type:z.z.literal("tool-result"),toolCallId:z.z.string(),toolName:z.z.string(),output:eU,providerOptions:ek.optional()}),eq=z.z.object({type:z.z.literal("tool-approval-request"),approvalId:z.z.string(),toolCallId:z.z.string()}),eB=z.z.object({type:z.z.literal("tool-approval-response"),approvalId:z.z.string(),approved:z.z.boolean(),reason:z.z.string().optional()}),eW=z.z.object({role:z.z.literal("system"),content:z.z.string(),providerOptions:ek.optional()}),eJ=z.z.object({role:z.z.literal("user"),content:z.z.union([z.z.string(),z.z.array(z.z.union([eO,eD,eP]))]),providerOptions:ek.optional()}),eV=z.z.object({role:z.z.literal("assistant"),content:z.z.union([z.z.string(),z.z.array(z.z.union([eO,eP,e$,eF,eL,eq]))]),providerOptions:ek.optional()}),eG=z.z.object({role:z.z.literal("tool"),content:z.z.array(z.z.union([eL,eB])),providerOptions:ek.optional()}),eY=z.z.union([eW,eJ,eV,eG]),eK={startSpan:()=>eZ,startActiveSpan:(e,t,a,r)=>"function"==typeof t?t(eZ):"function"==typeof a?a(eZ):"function"==typeof r?r(eZ):void 0},eZ={spanContext:()=>eH,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},eH={traceId:"",spanId:"",traceFlags:0};async function eQ({name:e,tracer:t,attributes:a,fn:r,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:await a},async e=>{try{let t=await r(e);return o&&e.end(),t}catch(t){try{eX(e,t)}finally{e.end()}throw t}})}function eX(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:SpanStatusCode.ERROR})}async function e0({telemetry:e,attributes:t}){if((null==e?void 0:e.isEnabled)!==!0)return{};let a={};for(let[r,o]of Object.entries(t))if(null!=o){if("object"==typeof o&&"input"in o&&"function"==typeof o.input){if((null==e?void 0:e.recordInputs)===!1)continue;let t=await o.input();null!=t&&(a[r]=t);continue}if("object"==typeof o&&"output"in o&&"function"==typeof o.output){if((null==e?void 0:e.recordOutputs)===!1)continue;let t=await o.output();null!=t&&(a[r]=t);continue}a[r]=o}return a}function e1(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}var e2=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:r}={})=>async o=>e8(o,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:r});async function e8(e,{maxRetries:t,delayInMs:a,backoffFactor:r,abortSignal:o},s=[]){try{return await e()}catch(p){if(isAbortError(p)||0===t)throw p;let i=getErrorMessage4(p),n=[...s,p],l=n.length;if(l>t)throw new ev({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:n});if(p instanceof Error&&APICallError2.isInstance(p)&&!0===p.isRetryable&&l<=t)return await delay(function({error:e,exponentialBackoffDelay:t}){let a;let r=e.responseHeaders;if(!r)return t;let o=r["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(a=e)}let s=r["retry-after"];if(s&&void 0===a){let e=parseFloat(s);a=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}return null!=a&&!Number.isNaN(a)&&0<=a&&(a<6e4||a<t)?a:t}({error:p,exponentialBackoffDelay:a}),{abortSignal:o}),e8(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r,abortSignal:o},n);if(1===l)throw p;throw new ev({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:n})}}async function e7({toolCall:e,tools:t,tracer:a,telemetry:r,messages:o,abortSignal:s,experimental_context:i,onPreliminaryToolResult:n}){let{toolName:l,toolCallId:p,input:u}=e,d=null==t?void 0:t[l];if((null==d?void 0:d.execute)!=null)return eQ({name:"ai.toolCall",attributes:e0({telemetry:r,attributes:{...function({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":l,"ai.toolCall.id":p,"ai.toolCall.args":{output:()=>JSON.stringify(u)}}}),tracer:a,fn:async t=>{let a;try{for await(let t of executeTool({execute:d.execute.bind(d),input:u,options:{toolCallId:p,messages:o,abortSignal:s,experimental_context:i}}))"preliminary"===t.type?null==n||n({...e,type:"tool-result",output:t.output,preliminary:!0}):a=t.output}catch(a){return eX(t,a),{type:"tool-error",toolCallId:p,toolName:l,input:u,error:a,dynamic:"dynamic"===d.type,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}}try{t.setAttributes(await e0({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}return{type:"tool-result",toolCallId:p,toolName:l,input:u,output:a,dynamic:"dynamic"===d.type,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}}})}var e3=class{constructor({data:e,mediaType:t}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,g.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,g.Z9)(this.base64Data)),this.uint8ArrayData}};async function e6(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,g.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,g.N8)({text:function(e){let t=["ROOT"],a=-1,r=null;function o(e,o,s){switch(e){case'"':a=o,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":a=o,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":a=o,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":o(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,o(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(r,n+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}((e,t)=>{for(var a in t)b(e,a,{get:t[a],enumerable:!0})})({},{array:()=>e9,choice:()=>te,json:()=>tt,object:()=>e5,text:()=>e4});var e4=()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),parseCompleteOutput:async({text:e})=>e,parsePartialOutput:async({text:e})=>({partial:e}),createElementStreamTransform(){}}),e5=({schema:e,name:t,description:a})=>{let r=(0,g.mD)(e);return{name:"object",responseFormat:(0,g.hd)(r.jsonSchema).then(e=>({type:"json",schema:e,...null!=t&&{name:t},...null!=a&&{description:a}})),async parseCompleteOutput({text:e},t){let a=await (0,g.N8)({text:e});if(!a.success)throw new L({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=await (0,g.ZZ)({value:a.value,schema:r});if(!o.success)throw new L({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return o.value},async parsePartialOutput({text:e}){let t=await e6(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value}}},createElementStreamTransform(){}}},e9=({element:e,name:t,description:a})=>{let r=(0,g.mD)(e);return{name:"array",responseFormat:(0,g.hd)(r.jsonSchema).then(e=>{let{$schema:r,...o}=e;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:o}},required:["elements"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}}),async parseCompleteOutput({text:e},t){let a=await (0,g.N8)({text:e});if(!a.success)throw new L({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=a.value;if(null==o||"object"!=typeof o||!("elements"in o)||!Array.isArray(o.elements))throw new L({message:"No object generated: response did not match schema.",cause:new y.iM({value:o,cause:"response must be an object with an elements array"}),text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});for(let a of o.elements){let o=await (0,g.ZZ)({value:a,schema:r});if(!o.success)throw new L({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason})}return o.elements},async parsePartialOutput({text:e}){let t=await e6(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let e=t.value;if(null==e||"object"!=typeof e||!("elements"in e)||!Array.isArray(e.elements))return;let a="repaired-parse"===t.state&&e.elements.length>0?e.elements.slice(0,-1):e.elements,o=[];for(let e of a){let t=await (0,g.ZZ)({value:e,schema:r});t.success&&o.push(t.value)}return{partial:o}}}},createElementStreamTransform(){let e=0;return new TransformStream({transform({partialOutput:t},a){if(null!=t)for(;e<t.length;e++)a.enqueue(t[e])}})}}},te=({options:e,name:t,description:a})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}),async parseCompleteOutput({text:t},a){let r=await (0,g.N8)({text:t});if(!r.success)throw new L({message:"No object generated: could not parse the response.",cause:r.error,text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=r.value;if(null==o||"object"!=typeof o||!("result"in o)||"string"!=typeof o.result||!e.includes(o.result))throw new L({message:"No object generated: response did not match schema.",cause:new y.iM({value:o,cause:"response must be an object that contains a choice value."}),text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.result},async parsePartialOutput({text:t}){let a=await e6(t);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let t=a.value;if(null==t||"object"!=typeof t||!("result"in t)||"string"!=typeof t.result)return;let r=e.filter(e=>e.startsWith(t.result));if("successful-parse"===a.state)return r.includes(t.result)?{partial:t.result}:void 0;return 1===r.length?{partial:r[0]}:void 0}}},createElementStreamTransform(){}}),tt=({name:e,description:t}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...null!=e&&{name:e},...null!=t&&{description:t}}),async parseCompleteOutput({text:e},t){let a=await (0,g.N8)({text:e});if(!a.success)throw new L({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return a.value},async parsePartialOutput({text:e}){let t=await e6(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return void 0===t.value?void 0:{partial:t.value}}},createElementStreamTransform(){}});async function ta(e){let t=""===e.input.trim()?{success:!0,value:{}}:await safeParseJSON3({text:e.input});if(!1===t.success)throw new j({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function tr({toolCall:e,tools:t}){let a=e.toolName,r=t[a];if(null==r){if(e.providerExecuted&&e.dynamic)return await ta(e);throw new K({toolName:e.toolName,availableTools:Object.keys(t)})}let o=asSchema3(r.inputSchema),s=""===e.input.trim()?await safeValidateTypes3({value:{},schema:o}):await safeParseJSON3({text:e.input,schema:o});if(!1===s.success)throw new j({toolName:a,toolInput:e.input,cause:s.error});return"dynamic"===r.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:r.title}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:r.title}}(0,g.hK)({prefix:"aitxt",size:24});function to(e,t){let a=new Headers(null!=e?e:{});for(let[e,r]of Object.entries(t))a.has(e)||a.set(e,r);return a}TransformStream;var ts=(0,g.ID)(()=>(0,g.jN)(z.z.union([z.z.strictObject({type:z.z.literal("text-start"),id:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("text-delta"),id:z.z.string(),delta:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("text-end"),id:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("error"),errorText:z.z.string()}),z.z.strictObject({type:z.z.literal("tool-input-start"),toolCallId:z.z.string(),toolName:z.z.string(),providerExecuted:z.z.boolean().optional(),dynamic:z.z.boolean().optional(),title:z.z.string().optional()}),z.z.strictObject({type:z.z.literal("tool-input-delta"),toolCallId:z.z.string(),inputTextDelta:z.z.string()}),z.z.strictObject({type:z.z.literal("tool-input-available"),toolCallId:z.z.string(),toolName:z.z.string(),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),providerMetadata:ek.optional(),dynamic:z.z.boolean().optional(),title:z.z.string().optional()}),z.z.strictObject({type:z.z.literal("tool-input-error"),toolCallId:z.z.string(),toolName:z.z.string(),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),providerMetadata:ek.optional(),dynamic:z.z.boolean().optional(),errorText:z.z.string(),title:z.z.string().optional()}),z.z.strictObject({type:z.z.literal("tool-approval-request"),approvalId:z.z.string(),toolCallId:z.z.string()}),z.z.strictObject({type:z.z.literal("tool-output-available"),toolCallId:z.z.string(),output:z.z.unknown(),providerExecuted:z.z.boolean().optional(),dynamic:z.z.boolean().optional(),preliminary:z.z.boolean().optional()}),z.z.strictObject({type:z.z.literal("tool-output-error"),toolCallId:z.z.string(),errorText:z.z.string(),providerExecuted:z.z.boolean().optional(),dynamic:z.z.boolean().optional()}),z.z.strictObject({type:z.z.literal("tool-output-denied"),toolCallId:z.z.string()}),z.z.strictObject({type:z.z.literal("reasoning-start"),id:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("reasoning-delta"),id:z.z.string(),delta:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("reasoning-end"),id:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("source-url"),sourceId:z.z.string(),url:z.z.string(),title:z.z.string().optional(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("source-document"),sourceId:z.z.string(),mediaType:z.z.string(),title:z.z.string(),filename:z.z.string().optional(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.literal("file"),url:z.z.string(),mediaType:z.z.string(),providerMetadata:ek.optional()}),z.z.strictObject({type:z.z.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:z.z.string().optional(),data:z.z.unknown(),transient:z.z.boolean().optional()}),z.z.strictObject({type:z.z.literal("start-step")}),z.z.strictObject({type:z.z.literal("finish-step")}),z.z.strictObject({type:z.z.literal("start"),messageId:z.z.string().optional(),messageMetadata:z.z.unknown().optional()}),z.z.strictObject({type:z.z.literal("finish"),finishReason:z.z.enum(["stop","length","content-filter","tool-calls","error","other"]).optional(),messageMetadata:z.z.unknown().optional()}),z.z.strictObject({type:z.z.literal("abort"),reason:z.z.string().optional()}),z.z.strictObject({type:z.z.literal("message-metadata"),messageMetadata:z.z.unknown()})])));function ti(e){return e.type.startsWith("data-")}function tn(e){return"text"===e.type}function tl(e){return"file"===e.type}function tp(e){return"reasoning"===e.type}function tu(e){return e.type.startsWith("tool-")}function td(e){return"dynamic-tool"===e.type}function tc(e){return tu(e)||td(e)}function tm(e){return e.type.split("-").slice(1).join("-")}function th(e){return td(e)?e.toolName:tm(e)}async function tv({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function tg(){let e,t;return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}}(0,g.hK)({prefix:"aitxt",size:24});var ty=(0,g.ID)(()=>(0,g.jN)(z.z.array(z.z.object({id:z.z.string(),role:z.z.enum(["system","user","assistant"]),metadata:z.z.unknown().optional(),parts:z.z.array(z.z.union([z.z.object({type:z.z.literal("text"),text:z.z.string(),state:z.z.enum(["streaming","done"]).optional(),providerMetadata:ek.optional()}),z.z.object({type:z.z.literal("reasoning"),text:z.z.string(),state:z.z.enum(["streaming","done"]).optional(),providerMetadata:ek.optional()}),z.z.object({type:z.z.literal("source-url"),sourceId:z.z.string(),url:z.z.string(),title:z.z.string().optional(),providerMetadata:ek.optional()}),z.z.object({type:z.z.literal("source-document"),sourceId:z.z.string(),mediaType:z.z.string(),title:z.z.string(),filename:z.z.string().optional(),providerMetadata:ek.optional()}),z.z.object({type:z.z.literal("file"),mediaType:z.z.string(),filename:z.z.string().optional(),url:z.z.string(),providerMetadata:ek.optional()}),z.z.object({type:z.z.literal("step-start")}),z.z.object({type:z.z.string().startsWith("data-"),id:z.z.string().optional(),data:z.z.unknown()}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("input-streaming"),input:z.z.unknown().optional(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),approval:z.z.never().optional()}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("input-available"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.never().optional()}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("approval-requested"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.never().optional(),reason:z.z.never().optional()})}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("approval-responded"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.boolean(),reason:z.z.string().optional()})}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("output-available"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.unknown(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),preliminary:z.z.boolean().optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!0),reason:z.z.string().optional()}).optional()}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("output-error"),input:z.z.unknown(),rawInput:z.z.unknown().optional(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.string(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!0),reason:z.z.string().optional()}).optional()}),z.z.object({type:z.z.literal("dynamic-tool"),toolName:z.z.string(),toolCallId:z.z.string(),state:z.z.literal("output-denied"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!1),reason:z.z.string().optional()})}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("input-streaming"),providerExecuted:z.z.boolean().optional(),input:z.z.unknown().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),approval:z.z.never().optional()}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("input-available"),providerExecuted:z.z.boolean().optional(),input:z.z.unknown(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.never().optional()}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("approval-requested"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.never().optional(),reason:z.z.never().optional()})}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("approval-responded"),input:z.z.unknown(),providerExecuted:z.z.boolean().optional(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.boolean(),reason:z.z.string().optional()})}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("output-available"),providerExecuted:z.z.boolean().optional(),input:z.z.unknown(),output:z.z.unknown(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),preliminary:z.z.boolean().optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!0),reason:z.z.string().optional()}).optional()}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("output-error"),providerExecuted:z.z.boolean().optional(),input:z.z.unknown(),rawInput:z.z.unknown().optional(),output:z.z.never().optional(),errorText:z.z.string(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!0),reason:z.z.string().optional()}).optional()}),z.z.object({type:z.z.string().startsWith("tool-"),toolCallId:z.z.string(),state:z.z.literal("output-denied"),providerExecuted:z.z.boolean().optional(),input:z.z.unknown(),output:z.z.never().optional(),errorText:z.z.never().optional(),callProviderMetadata:ek.optional(),approval:z.z.object({id:z.z.string(),approved:z.z.literal(!1),reason:z.z.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")));async function tz({messages:e,metadataSchema:t,dataSchemas:a,tools:r}){try{if(null==e)return{success:!1,error:new w({parameter:"messages",value:e,message:"messages parameter must be provided"})};let o=await validateTypes2({value:e,schema:ty});if(t)for(let e of o)await validateTypes2({value:e.metadata,schema:t});if(a)for(let e of o)for(let t of e.parts.filter(e=>e.type.startsWith("data-"))){let e=t.type.slice(5),r=a[e];if(!r)return{success:!1,error:new TypeValidationError3({value:t.data,cause:`No data schema found for data part ${e}`})};await validateTypes2({value:t.data,schema:r})}if(r)for(let e of o)for(let t of e.parts.filter(e=>e.type.startsWith("tool-"))){let e=t.type.slice(5),a=r[e];if(!a)return{success:!1,error:new TypeValidationError3({value:t.input,cause:`No tool schema found for tool part ${e}`})};("input-available"===t.state||"output-available"===t.state||"output-error"===t.state&&void 0!==t.input)&&await validateTypes2({value:t.input,schema:a.inputSchema}),"output-available"===t.state&&a.outputSchema&&await validateTypes2({value:t.output,schema:a.outputSchema})}return{success:!0,data:o}}catch(e){return{success:!1,error:e}}}async function tf(e,t,a){let r=await safeParseJSON4({text:e});if(!r.success)throw new L({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=await t.validateFinalResult(r.value,{text:e,response:a.response,usage:a.usage});if(!o.success)throw new L({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value}(0,g.hK)({prefix:"aiobj",size:24});var tb=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,g.hK)({prefix:"aiobj",size:24});var tI=({model:e,middleware:{transformParams:t,wrapGenerate:a,wrapStream:r,overrideProvider:o,overrideModelId:s,overrideSupportedUrls:i},modelId:n,providerId:l})=>{var p,u,d;async function c({params:a,type:r}){return t?await t({params:a,type:r,model:e}):a}return{specificationVersion:"v3",provider:null!=(p=null!=l?l:null==o?void 0:o({model:e}))?p:e.provider,modelId:null!=(u=null!=n?n:null==s?void 0:s({model:e}))?u:e.modelId,supportedUrls:null!=(d=null==i?void 0:i({model:e}))?d:e.supportedUrls,async doGenerate(t){let r=await c({params:t,type:"generate"}),o=async()=>e.doGenerate(r),s=async()=>e.doStream(r);return a?a({doGenerate:o,doStream:s,params:r,model:e}):o()},async doStream(t){let a=await c({params:t,type:"stream"}),o=async()=>e.doGenerate(a),s=async()=>e.doStream(a);return r?r({doGenerate:o,doStream:s,params:a,model:e}):s()}}},tE=({model:e,middleware:{transformParams:t,wrapGenerate:a,overrideProvider:r,overrideModelId:o,overrideMaxImagesPerCall:s},modelId:i,providerId:n})=>{var l,p,u;async function d({params:a}){return t?await t({params:a,model:e}):a}let c=null!=(l=null==s?void 0:s({model:e}))?l:e.maxImagesPerCall,m=c instanceof Function?c.bind(e):c;return{specificationVersion:"v3",provider:null!=(p=null!=n?n:null==r?void 0:r({model:e}))?p:e.provider,modelId:null!=(u=null!=i?i:null==o?void 0:o({model:e}))?u:e.modelId,maxImagesPerCall:m,async doGenerate(t){let r=await d({params:t}),o=async()=>e.doGenerate(r);return a?a({doGenerate:o,params:r,model:e}):o()}}},tx="AI_NoSuchProviderError",tw=`vercel.ai.error.${tx}`,tT=Symbol.for(tw);async function tR(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}y.eM,v=tT,y.bD;var tN=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:o,prepareSendMessagesRequest:s,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=o,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:e,...t}){var a,r,o,s,i;let n=await (0,g.hd)(this.body),l=await (0,g.hd)(this.headers),p=await (0,g.hd)(this.credentials),u={...(0,g.qx)(l),...(0,g.qx)(t.headers)},d=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:u,credentials:p,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),c=null!=(r=null==d?void 0:d.api)?r:this.api,m=(null==d?void 0:d.headers)!==void 0?(0,g.qx)(d.headers):u,h=(null==d?void 0:d.body)!==void 0?d.body:{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},v=null!=(o=null==d?void 0:d.credentials)?o:p,y=null!=(s=this.fetch)?s:globalThis.fetch,z=await y(c,{method:"POST",headers:(0,g.WZ)({"Content-Type":"application/json",...m},`ai-sdk/${ex}`,(0,g.G1)()),body:JSON.stringify(h),credentials:v,signal:e});if(!z.ok)throw Error(null!=(i=await z.text())?i:"Failed to fetch the chat response.");if(!z.body)throw Error("The response body is empty.");return this.processResponseStream(z.body)}async reconnectToStream(e){var t,a,r,o,s;let i=await (0,g.hd)(this.body),n=await (0,g.hd)(this.headers),l=await (0,g.hd)(this.credentials),p={...(0,g.qx)(n),...(0,g.qx)(e.headers)},u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...i,...e.body},headers:p,credentials:l,requestMetadata:e.metadata})),d=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,c=(null==u?void 0:u.headers)!==void 0?(0,g.qx)(u.headers):p,m=null!=(r=null==u?void 0:u.credentials)?r:l,h=null!=(o=this.fetch)?o:globalThis.fetch,v=await h(d,{method:"GET",headers:(0,g.WZ)(c,`ai-sdk/${ex}`,(0,g.G1)()),credentials:m});if(204===v.status)return null;if(!v.ok)throw Error(null!=(s=await v.text())?s:"Failed to fetch the chat response.");if(!v.body)throw Error("The response body is empty.");return this.processResponseStream(v.body)}},tM=class extends tN{constructor(e={}){super(e)}processResponseStream(e){return(0,g._Z)({stream:e,schema:ts}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},tS=class{constructor({generateId:e=g.$C,id:t=e(),transport:a=new tM,messageMetadataSchema:r,dataPartSchemas:o,state:s,onError:i,onToolCall:n,onFinish:l,onData:p,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new tb,this.sendMessage=async(e,t)=>{var a,r,o,s;let i;if(null==e){await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});return}if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await tR(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(o=i.id)?o:this.generateId(),role:null!=(s=i.role)?s:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolApprovalResponse=async({id:e,approved:t,reason:a})=>this.jobExecutor.run(async()=>{var r,o;let s=this.state.messages,i=s[s.length-1],n=r=>tc(r)&&"approval-requested"===r.state&&r.approval.id===e?{...r,state:"approval-responded",approval:{id:e,approved:t,reason:a}}:r;this.state.replaceMessage(s.length-1,{...i,parts:i.parts.map(n)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(n)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(r=this.sendAutomaticallyWhen)?void 0:r.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(o=this.lastMessage)?void 0:o.id})}),this.addToolOutput=async({state:e="output-available",tool:t,toolCallId:a,output:r,errorText:o})=>this.jobExecutor.run(async()=>{var t,s;let i=this.state.messages,n=i[i.length-1],l=t=>tc(t)&&t.toolCallId===a?{...t,state:e,output:r,errorText:o}:t;this.state.replaceMessage(i.length-1,{...n,parts:n.parts.map(l)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(l)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(t=this.sendAutomaticallyWhen)?void 0:t.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(s=this.lastMessage)?void 0:s.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=o,this.state=s,this.onError=i,this.onToolCall=n,this.onFinish=l,this.onData=p,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:o}){var s,i,n,l;this.setStatus({status:"submitted",error:void 0});let p=this.lastMessage,u=!1,d=!1,c=!1;try{let s;let i={state:function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(p),messageId:this.generateId()}),abortController:new AbortController};if(i.abortController.signal.addEventListener("abort",()=>{u=!0}),this.activeResponse=i,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e){this.setStatus({status:"ready"});return}s=e}else s=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:i.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:o});await tv({stream:function({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:o,onToolCall:s,onData:i}){return e.pipeThrough(new TransformStream({async transform(e,n){await r(async({state:r,write:l})=>{var p,u,d,c;function m(e){let t=r.message.parts.filter(tc).find(t=>t.toolCallId===e);if(null==t)throw Error(`no tool invocation found for tool call ${e}`);return t}function h(e){var t;let a=r.message.parts.find(t=>tu(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,void 0!==e.title&&(a.title=e.title),a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,title:e.title,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function v(e){var t,a;let o=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=o?(o.state=e.state,o.toolName=e.toolName,o.input=e.input,o.output=e.output,o.errorText=e.errorText,o.rawInput=null!=(t=e.rawInput)?t:o.rawInput,o.preliminary=e.preliminary,void 0!==e.title&&(o.title=e.title),o.providerExecuted=null!=(a=e.providerExecuted)?a:o.providerExecuted,null!=e.providerMetadata&&"input-available"===o.state&&(o.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:e.title,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function y(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){let s=a[o];if(void 0===s)continue;let i=o in t?t[o]:void 0,n=null!==s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);n&&l?r[o]=e(i,s):r[o]=s}return r}(r.message.metadata,e):e;null!=t&&await (0,g.k5)({value:a,schema:t}),r.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeTextParts[e.id]=t,r.message.parts.push(t),l();break}case"text-delta":{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,l();break}case"text-end":{let t=r.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,delete r.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),l();break}case"reasoning-delta":{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,l();break}case"reasoning-end":{let t=r.activeReasoningParts[e.id];t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],l();break}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=r.message.parts.filter(tu);r.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic,title:e.title},e.dynamic?v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title}),l();break}case"tool-input-delta":{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await e6(t.text);t.dynamic?v({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}):h({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}),l();break}case"tool-input-available":e.dynamic?v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}),l(),s&&!e.providerExecuted&&await s({toolCall:e});break;case"tool-input-error":e.dynamic?v({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l();break;case"tool-approval-request":{let t=m(e.toolCallId);t.state="approval-requested",t.approval={id:e.approvalId},l();break}case"tool-output-denied":m(e.toolCallId).state="output-denied",l();break;case"tool-output-available":{let t=m(e.toolCallId);"dynamic-tool"===t.type?v({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:t.title}):h({toolCallId:e.toolCallId,toolName:tm(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary,title:t.title}),l();break}case"tool-output-error":{let t=m(e.toolCallId);"dynamic-tool"===t.type?v({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}):h({toolCallId:e.toolCallId,toolName:tm(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}),l();break}case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await y(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":null!=e.finishReason&&(r.finishReason=e.finishReason),await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"message-metadata":await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==o||o(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null&&await (0,g.k5)({value:e.data,schema:a[e.type]}),e.transient){null==i||i(e);break}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==i||i(e),l()}}n.enqueue(e)})}}))}({stream:s,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:i.state,write:()=>{var e;this.setStatus({status:"streaming"}),i.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,i.state.message):this.state.pushMessage(i.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:"ready"})}catch(e){if(u||"AbortError"===e.name)return u=!0,this.setStatus({status:"ready"}),null;c=!0,e instanceof TypeError&&(e.message.toLowerCase().includes("fetch")||e.message.toLowerCase().includes("network"))&&(d=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{try{null==(i=this.onFinish)||i.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:u,isDisconnect:d,isError:c,finishReason:null==(s=this.activeResponse)?void 0:s.state.finishReason})}catch(e){console.error(e)}this.activeResponse=void 0}(null==(n=this.sendAutomaticallyWhen)?void 0:n.call(this,{messages:this.state.messages}))&&!c&&await this.makeRequest({trigger:"submit-message",messageId:null==(l=this.lastMessage)?void 0:l.id,metadata:t,headers:a,body:r})}};function tA({messages:e}){let t=e[e.length-1];if(!t||"assistant"!==t.role)return!1;let a=t.parts.reduce((e,t,a)=>"step-start"===t.type?a:e,-1),r=t.parts.slice(a+1).filter(tc).filter(e=>!e.providerExecuted);return r.length>0&&r.every(e=>"output-available"===e.state||"output-error"===e.state)}}}]);