(()=>{var e={};e.id=8974,e.ids=[8974],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},61275:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>u,routeModule:()=>c,tree:()=>d});var s=t(70260),a=t(28203),i=t(25155),n=t.n(i),o=t(67292),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,61377)),"/home/runner/work/PartFiles/PartFiles/src/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,69096)),"/home/runner/work/PartFiles/PartFiles/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/home/runner/work/PartFiles/PartFiles/src/app/page.tsx"],p={require:t,loadChunk:()=>Promise.resolve()},c=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},96487:()=>{},78335:()=>{},61377:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var s=t(31831),a=t(60809);async function i(){let e=await (0,a.j2)();e?.user&&(0,s.redirect)("/upload"),(0,s.redirect)("/login")}},60809:(e,r,t)=>{"use strict";t.d(r,{j2:()=>m,Y9:()=>p});var s=t(57971),a=t(23352),i=t(34926),n=t(84908);let o={pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e),authorized({auth:e,request:{nextUrl:r,headers:t}}){let s=e?.user?.role,a=!!e?.user&&!!s,i=r.pathname;if(i.startsWith("/login")||i.startsWith("/invite")||i.startsWith("/api/auth")||i.startsWith("/api/invite")||i.startsWith("/api/preview")||/^(\/api\/content\/[^/]+(\/raw)?)$/.test(i)||/^(\/(c|r|s|e)\/[^/]+)$/.test(i)||i.startsWith("/api/cron"))return!0;let n=function(e,r){let t=r.get("x-forwarded-host"),s=r.get("x-forwarded-proto")||"https";return t?`${s}://${t}`:e.origin}(r,t);if(!a){if(t.get("x-forwarded-host")){let e=new URL("/login",n);return e.searchParams.set("callbackUrl",r.pathname+r.search),Response.redirect(e)}return!1}return!((i.startsWith("/admin")||i.startsWith("/api/admin"))&&"admin"!==s||("/upload"===i||i.startsWith("/api/upload"))&&"admin"!==s&&"uploader"!==s)||Response.redirect(new URL("/dashboard",n))}},providers:[],session:{strategy:"jwt"}},l=new Map,d=Date.now();function u(){let e=Date.now();if(!(e-d<3e5))for(let[r,t]of(d=e,l))e>t.resetAt&&l.delete(r)}let{handlers:p,signIn:c,signOut:f,auth:m}=(0,s.Ay)({...o,callbacks:{...o.callbacks,async jwt({token:e,user:r}){if(r)return e.id=r.id,e.role=r.role,e.revalidatedAt=Date.now(),e;let t=e.revalidatedAt??0;if(Date.now()-t>3e5){let r=await n.z.user.findUnique({where:{id:e.id},select:{id:!0,role:!0}});if(!r)return e.id=void 0,e.role=void 0,e.revalidatedAt=void 0,e;e.role=r.role,e.revalidatedAt=Date.now()}return e}},providers:[(0,a.A)({name:"credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.username||!e?.password)return null;let r=e.username.toLowerCase(),t=e.password;if(function(e){u();let r=Date.now(),t=l.get(e);return!!t&&!(r>t.resetAt)&&t.failures>=5}(r))return null;let s=await n.z.user.findUnique({where:{username:r}});return s&&(0,i.Dm)(t,s.passwordHash)?(l.delete(r),{id:s.id,name:s.username,role:s.role}):(function(e){u();let r=Date.now(),t=l.get(e);!t||r>t.resetAt?l.set(e,{failures:1,resetAt:r+9e5}):(t.failures++,t.failures)}(r),null)}})]})},84908:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(96330),a=t(64981),i=t(33873),n=t.n(i);let o=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let r=e.slice(5),t=n().resolve(process.cwd(),r);return`file:${t}`}return e}(),r=new a.C({url:e});return new s.PrismaClient({adapter:r})}()},70440:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});var s=t(88077);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,9187,4981,4926,2787,5522,606,8077,6648],()=>t(61275));module.exports=s})();