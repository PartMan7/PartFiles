(()=>{var e={};e.id=603,e.ids=[603],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},75599:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>w,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>l});var n=r(42706),i=r(28203),a=r(45994),o=r(39187),u=r(84908),p=r(34926);async function d(e,{params:t}){let{token:r}=await t,s=await u.z.inviteToken.findUnique({where:{token:r},select:{id:!0,expiresAt:!0,usedAt:!0,user:{select:{username:!0}}}});return s?s.usedAt?o.NextResponse.json({error:"This invite link has already been used"},{status:410}):new Date(s.expiresAt)<new Date?o.NextResponse.json({error:"This invite link has expired"},{status:410}):o.NextResponse.json({valid:!0,username:s.user.username}):o.NextResponse.json({error:"Invalid invite link"},{status:404})}async function l(e,{params:t}){let{token:r}=await t;try{let{password:t}=await e.json();if(!t||"string"!=typeof t)return o.NextResponse.json({error:"Password is required"},{status:400});if(t.length<8)return o.NextResponse.json({error:"Password must be at least 8 characters"},{status:400});let s=await u.z.inviteToken.findUnique({where:{token:r},include:{user:{select:{id:!0,username:!0}}}});if(!s)return o.NextResponse.json({error:"Invalid invite link"},{status:404});if(s.usedAt)return o.NextResponse.json({error:"This invite link has already been used"},{status:410});if(new Date(s.expiresAt)<new Date)return o.NextResponse.json({error:"This invite link has expired"},{status:410});return await u.z.$transaction([u.z.user.update({where:{id:s.user.id},data:{passwordHash:(0,p.Y8)(t,12)}}),u.z.inviteToken.update({where:{id:s.id},data:{usedAt:new Date}})]),o.NextResponse.json({success:!0,username:s.user.username})}catch(e){return console.error("Invite redemption error:",e),o.NextResponse.json({error:"Failed to set password"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/invite/[token]/route",pathname:"/api/invite/[token]",filename:"route",bundlePath:"app/api/invite/[token]/route"},resolvedPagePath:"/home/runner/work/PartFiles/PartFiles/src/app/api/invite/[token]/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:v,serverHooks:w}=c;function h(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:v})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var s=r(96330),n=r(64981),i=r(33873),a=r.n(i);let o=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=a().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new n.C({url:e});return new s.PrismaClient({adapter:t})}()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,9187,4981,4926],()=>r(75599));module.exports=s})();