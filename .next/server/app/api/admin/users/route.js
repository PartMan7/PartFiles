(()=>{var e={};e.id=6950,e.ids=[6950],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},54880:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>x,serverHooks:()=>j,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>h});var a=r(42706),n=r(28203),o=r(45994),i=r(39187),u=r(55511),d=r(60809),l=r(84908),p=r(23946),c=r(34926),f=r(21950),w=r(99111);async function m(){let e=await (0,d.j2)();if(!e?.user||!(0,p.qc)(e.user.role))return i.NextResponse.json({error:"Forbidden"},{status:403});let t=await l.z.user.findMany({select:{id:!0,username:!0,role:!0,createdAt:!0,updatedAt:!0,_count:{select:{content:!0}}},orderBy:{createdAt:"desc"}});return i.NextResponse.json({users:t})}async function h(e){let t=await (0,d.j2)();if(!t?.user||!(0,p.qc)(t.user.role))return i.NextResponse.json({error:"Forbidden"},{status:403});try{let{username:t,password:r,role:s,invite:a}=await e.json();if(!t)return i.NextResponse.json({error:"Username is required"},{status:400});if(t.length<3||t.length>50)return i.NextResponse.json({error:"Username must be 3-50 characters"},{status:400});if(s&&!f.gg.includes(s))return i.NextResponse.json({error:`Invalid role. Must be one of: ${f.gg.join(", ")}`},{status:400});if(await l.z.user.findUnique({where:{username:t}}))return i.NextResponse.json({error:"Username already taken"},{status:409});if(a){let e=(0,u.randomBytes)(32).toString("hex"),r=new Date(Date.now()+1728e5),a=await l.z.user.create({data:{username:t,passwordHash:"!INVITE_PENDING",role:s||"guest",inviteTokens:{create:{token:e,expiresAt:r}}},select:{id:!0,username:!0,role:!0,createdAt:!0}}),n=`${(0,w.$)()}/invite/${e}`;return i.NextResponse.json({user:a,inviteUrl:n},{status:201})}if(!r)return i.NextResponse.json({error:"Password is required (or use invite mode)"},{status:400});if(r.length<8)return i.NextResponse.json({error:"Password must be at least 8 characters"},{status:400});let n=await l.z.user.create({data:{username:t,passwordHash:(0,c.Y8)(r,12),role:s||"guest"},select:{id:!0,username:!0,role:!0,createdAt:!0}});return i.NextResponse.json({user:n},{status:201})}catch(e){return console.error("Create user error:",e),i.NextResponse.json({error:"Failed to create user"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"/home/runner/work/PartFiles/PartFiles/src/app/api/admin/users/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:g,serverHooks:j}=x;function R(){return(0,o.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:g})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},60809:(e,t,r)=>{"use strict";r.d(t,{j2:()=>w,Y9:()=>p});var s=r(57971),a=r(23352),n=r(34926),o=r(84908);let i={pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e),authorized({auth:e,request:{nextUrl:t,headers:r}}){let s=e?.user?.role,a=!!e?.user&&!!s,n=t.pathname;if(n.startsWith("/login")||n.startsWith("/invite")||n.startsWith("/api/auth")||n.startsWith("/api/invite")||n.startsWith("/api/preview")||/^(\/api\/content\/[^/]+(\/raw)?)$/.test(n)||/^(\/(c|r|s|e)\/[^/]+)$/.test(n)||n.startsWith("/api/cron"))return!0;let o=function(e,t){let r=t.get("x-forwarded-host"),s=t.get("x-forwarded-proto")||"https";return r?`${s}://${r}`:e.origin}(t,r);if(!a){if(r.get("x-forwarded-host")){let e=new URL("/login",o);return e.searchParams.set("callbackUrl",t.pathname+t.search),Response.redirect(e)}return!1}return!((n.startsWith("/admin")||n.startsWith("/api/admin"))&&"admin"!==s||("/upload"===n||n.startsWith("/api/upload"))&&"admin"!==s&&"uploader"!==s)||Response.redirect(new URL("/dashboard",o))}},providers:[],session:{strategy:"jwt"}},u=new Map,d=Date.now();function l(){let e=Date.now();if(!(e-d<3e5))for(let[t,r]of(d=e,u))e>r.resetAt&&u.delete(t)}let{handlers:p,signIn:c,signOut:f,auth:w}=(0,s.Ay)({...i,callbacks:{...i.callbacks,async jwt({token:e,user:t}){if(t)return e.id=t.id,e.role=t.role,e.revalidatedAt=Date.now(),e;let r=e.revalidatedAt??0;if(Date.now()-r>3e5){let t=await o.z.user.findUnique({where:{id:e.id},select:{id:!0,role:!0}});if(!t)return e.id=void 0,e.role=void 0,e.revalidatedAt=void 0,e;e.role=t.role,e.revalidatedAt=Date.now()}return e}},providers:[(0,a.A)({name:"credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.username||!e?.password)return null;let t=e.username.toLowerCase(),r=e.password;if(function(e){l();let t=Date.now(),r=u.get(e);return!!r&&!(t>r.resetAt)&&r.failures>=5}(t))return null;let s=await o.z.user.findUnique({where:{username:t}});return s&&(0,n.Dm)(r,s.passwordHash)?(u.delete(t),{id:s.id,name:s.username,role:s.role}):(function(e){l();let t=Date.now(),r=u.get(e);!r||t>r.resetAt?u.set(e,{failures:1,resetAt:t+9e5}):(r.failures++,r.failures)}(t),null)}})]})},21950:(e,t,r)=>{"use strict";r.d(t,{AW:()=>c,C1:()=>p,ED:()=>u,S_:()=>f,bD:()=>l,gg:()=>n,pD:()=>o,w3:()=>i,y2:()=>d});var s=r(33873),a=r.n(s);let n=["admin","uploader","guest"],o={admin:0x80000000,uploader:524288e3,guest:0},i=0x6400000,u=168,d=1,l=5,p=new Set([".jpg",".jpeg",".png",".gif",".webp",".bmp",".ico",".tiff",".avif",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp",".txt",".csv",".rtf",".zip",".tar",".gz",".bz2",".7z",".rar",".mp3",".mp4",".wav",".ogg",".webm",".avi",".mov",".flv",".mkv",".json",".xml",".yaml",".yml",".woff",".woff2",".ttf",".otf",".eot"]),c=new Set([".html",".htm",".js",".jsx",".ts",".tsx",".svg",".php",".asp",".aspx",".jsp",".cgi",".sh",".bash",".bat",".cmd",".exe",".msi",".dll",".so",".dylib",".phtml",".phar",".htaccess",".htpasswd",".xslt"]),f=process.env.UPLOAD_DIR||a().join(process.cwd(),"uploads");if((process.env.AUTH_SECRET||process.env.NEXTAUTH_SECRET||"").length<32)throw Error("AUTH_SECRET (or NEXTAUTH_SECRET) must be set and at least 32 characters in production. Generate one with: openssl rand -base64 32")},23946:(e,t,r)=>{"use strict";r.d(t,{Yl:()=>n,qc:()=>o});let s={guest:0,uploader:1,admin:2};function a(e,t){let r=s[e],a=s[t];return void 0!==r&&void 0!==a&&r>=a}function n(e){return a(e,"uploader")}function o(e){return a(e,"admin")}},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var s=r(96330),a=r(64981),n=r(33873),o=r.n(n);let i=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=o().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new a.C({url:e});return new s.PrismaClient({adapter:t})}()},99111:(e,t,r)=>{"use strict";function s(){return process.env.BASE_URL?process.env.BASE_URL.replace(/\/+$/,""):`http://localhost:${process.env.PORT||3e3}`}function a(){return process.env.CONTENT_URL?process.env.CONTENT_URL.replace(/\/+$/,""):s()}r.d(t,{$:()=>s,D:()=>a})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,9187,4981,4926,2787,5522],()=>r(54880));module.exports=s})();