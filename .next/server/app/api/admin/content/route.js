(()=>{var e={};e.id=4601,e.ids=[4601],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},81831:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p});var i=r(42706),a=r(28203),n=r(45994),o=r(39187),l=r(60809),u=r(84908),d=r(23946);async function p(e){let t=await (0,l.j2)();if(!t?.user||!(0,d.qc)(t.user.role))return o.NextResponse.json({error:"Forbidden"},{status:403});let r=e.nextUrl.searchParams.get("expired"),s={};"active"===r?s.OR=[{expiresAt:null},{expiresAt:{gt:new Date}}]:"expired"===r&&(s.expiresAt={lte:new Date});let i=(await u.z.content.findMany({where:s,select:{id:!0,filename:!0,originalFilename:!0,directory:!0,fileSize:!0,fileExtension:!0,mimeType:!0,expiresAt:!0,createdAt:!0,previewPath:!0,uploadedBy:{select:{id:!0,username:!0,role:!0}},shortSlugs:{select:{slug:!0}}},orderBy:{createdAt:"desc"}})).map(({previewPath:e,...t})=>({...t,hasPreview:!!e}));return o.NextResponse.json({content:i})}let c=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/content/route",pathname:"/api/admin/content",filename:"route",bundlePath:"app/api/admin/content/route"},resolvedPagePath:"/home/runner/work/PartFiles/PartFiles/src/app/api/admin/content/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:m}=c;function x(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},60809:(e,t,r)=>{"use strict";r.d(t,{j2:()=>f,Y9:()=>p});var s=r(57971),i=r(23352),a=r(34926),n=r(84908);let o={pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e),authorized({auth:e,request:{nextUrl:t,headers:r}}){let s=e?.user?.role,i=!!e?.user&&!!s,a=t.pathname;if(a.startsWith("/login")||a.startsWith("/invite")||a.startsWith("/api/auth")||a.startsWith("/api/invite")||a.startsWith("/api/preview")||/^(\/api\/content\/[^/]+(\/raw)?)$/.test(a)||/^(\/(c|r|s|e)\/[^/]+)$/.test(a)||a.startsWith("/api/cron"))return!0;let n=function(e,t){let r=t.get("x-forwarded-host"),s=t.get("x-forwarded-proto")||"https";return r?`${s}://${r}`:e.origin}(t,r);if(!i){if(r.get("x-forwarded-host")){let e=new URL("/login",n);return e.searchParams.set("callbackUrl",t.pathname+t.search),Response.redirect(e)}return!1}return!((a.startsWith("/admin")||a.startsWith("/api/admin"))&&"admin"!==s||("/upload"===a||a.startsWith("/api/upload"))&&"admin"!==s&&"uploader"!==s)||Response.redirect(new URL("/dashboard",n))}},providers:[],session:{strategy:"jwt"}},l=new Map,u=Date.now();function d(){let e=Date.now();if(!(e-u<3e5))for(let[t,r]of(u=e,l))e>r.resetAt&&l.delete(t)}let{handlers:p,signIn:c,signOut:w,auth:f}=(0,s.Ay)({...o,callbacks:{...o.callbacks,async jwt({token:e,user:t}){if(t)return e.id=t.id,e.role=t.role,e.revalidatedAt=Date.now(),e;let r=e.revalidatedAt??0;if(Date.now()-r>3e5){let t=await n.z.user.findUnique({where:{id:e.id},select:{id:!0,role:!0}});if(!t)return e.id=void 0,e.role=void 0,e.revalidatedAt=void 0,e;e.role=t.role,e.revalidatedAt=Date.now()}return e}},providers:[(0,i.A)({name:"credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.username||!e?.password)return null;let t=e.username.toLowerCase(),r=e.password;if(function(e){d();let t=Date.now(),r=l.get(e);return!!r&&!(t>r.resetAt)&&r.failures>=5}(t))return null;let s=await n.z.user.findUnique({where:{username:t}});return s&&(0,a.Dm)(r,s.passwordHash)?(l.delete(t),{id:s.id,name:s.username,role:s.role}):(function(e){d();let t=Date.now(),r=l.get(e);!r||t>r.resetAt?l.set(e,{failures:1,resetAt:t+9e5}):(r.failures++,r.failures)}(t),null)}})]})},23946:(e,t,r)=>{"use strict";r.d(t,{Yl:()=>a,qc:()=>n});let s={guest:0,uploader:1,admin:2};function i(e,t){let r=s[e],i=s[t];return void 0!==r&&void 0!==i&&r>=i}function a(e){return i(e,"uploader")}function n(e){return i(e,"admin")}},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var s=r(96330),i=r(64981),a=r(33873),n=r.n(a);let o=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=n().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new i.C({url:e});return new s.PrismaClient({adapter:t})}()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,9187,4981,4926,2787,5522],()=>r(81831));module.exports=s})();