(()=>{var e={};e.id=5683,e.ids=[5683],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9288:e=>{"use strict";e.exports=require("sharp")},55511:e=>{"use strict";e.exports=require("crypto")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},33873:e=>{"use strict";e.exports=require("path")},46333:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>m,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{POST:()=>d});var n=r(42706),i=r(28203),a=r(45994),o=r(39187),u=r(84908),c=r(88479),p=r(4886),l=r(55511);async function d(e){let t=e.headers.get("x-cron-secret")||"",r=process.env.CRON_SECRET||"";if(!r||!t||!function(e,t){let r=Buffer.from(e),s=Buffer.from(t);return r.byteLength===s.byteLength&&(0,l.timingSafeEqual)(r,s)}(t,r))return o.NextResponse.json({error:"Forbidden"},{status:403});try{let e=await u.z.content.findMany({where:{expiresAt:{lt:new Date}}}),t=0,r=0;for(let s of e)try{await (0,c.Ww)(s.storagePath),await (0,p.mH)(s.previewPath),await u.z.content.delete({where:{id:s.id}}),t++}catch(e){console.error(`Failed to delete content ${s.id}:`,e),r++}return o.NextResponse.json({success:!0,found:e.length,deleted:t,errors:r})}catch(e){return console.error("Cleanup error:",e),o.NextResponse.json({error:"Cleanup failed"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/cron/cleanup/route",pathname:"/api/cron/cleanup",filename:"route",bundlePath:"app/api/cron/cleanup/route"},resolvedPagePath:"/home/runner/work/PartFiles/PartFiles/src/app/api/cron/cleanup/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:m}=f;function v(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},21950:(e,t,r)=>{"use strict";r.d(t,{AW:()=>d,C1:()=>l,ED:()=>u,S_:()=>f,bD:()=>p,gg:()=>i,pD:()=>a,w3:()=>o,y2:()=>c});var s=r(33873),n=r.n(s);let i=["admin","uploader","guest"],a={admin:0x80000000,uploader:524288e3,guest:0},o=0x6400000,u=168,c=1,p=5,l=new Set([".jpg",".jpeg",".png",".gif",".webp",".bmp",".ico",".tiff",".avif",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp",".txt",".csv",".rtf",".zip",".tar",".gz",".bz2",".7z",".rar",".mp3",".mp4",".wav",".ogg",".webm",".avi",".mov",".flv",".mkv",".json",".xml",".yaml",".yml",".woff",".woff2",".ttf",".otf",".eot"]),d=new Set([".html",".htm",".js",".jsx",".ts",".tsx",".svg",".php",".asp",".aspx",".jsp",".cgi",".sh",".bash",".bat",".cmd",".exe",".msi",".dll",".so",".dylib",".phtml",".phar",".htaccess",".htpasswd",".xslt"]),f=process.env.UPLOAD_DIR||n().join(process.cwd(),"uploads");if((process.env.AUTH_SECRET||process.env.NEXTAUTH_SECRET||"").length<32)throw Error("AUTH_SECRET (or NEXTAUTH_SECRET) must be set and at least 32 characters in production. Generate one with: openssl rand -base64 32")},4886:(e,t,r)=>{"use strict";r.d(t,{mH:()=>c,sM:()=>u});var s=r(9288),n=r.n(s),i=r(88479);let a=new Set(["image/jpeg","image/png","image/gif","image/webp","image/avif","image/tiff","image/bmp"]);async function o(e){try{return await n()(e).resize(200,200,{fit:"inside",withoutEnlargement:!0}).jpeg({quality:50,progressive:!0}).toBuffer()}catch{return null}}async function u(e,t,r,s){if(!a.has(t))return null;let n=await o(e);if(!n)return null;let u=`preview-${r}.jpg`;try{return await (0,i.OJ)(n,u,s)}catch{return null}}async function c(e){if(e)try{await (0,i.Ww)(e)}catch{}}},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var s=r(96330),n=r(64981),i=r(33873),a=r.n(i);let o=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=a().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new n.C({url:e});return new s.PrismaClient({adapter:t})}()},88479:(e,t,r)=>{"use strict";r.d(t,{OJ:()=>c,Ww:()=>l,oK:()=>p});var s=r(79748),n=r.n(s),i=r(29021),a=r(33873),o=r.n(a),u=r(21950);async function c(e,t,r){let s=function(e){let t=e?o().join(u.S_,e):u.S_,r=o().resolve(t),s=o().resolve(u.S_);if(r!==s&&!r.startsWith(s+o().sep))throw Error("Path traversal detected in directory");return(0,i.existsSync)(t)||(0,i.mkdirSync)(t,{recursive:!0}),t}(r),a=o().join(s,t),c=o().resolve(a),p=o().resolve(u.S_);if(c!==p&&!c.startsWith(p+o().sep))throw Error("Path traversal detected");return await n().writeFile(a,e),o().relative(u.S_,a)}function p(e){let t=o().resolve(o().join(u.S_,e)),r=o().resolve(u.S_);if(t!==r&&!t.startsWith(r+o().sep))throw Error("Path traversal detected");return t}async function l(e){let t=p(e);try{await n().unlink(t)}catch(e){if("ENOENT"!==e.code)throw e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,9187,4981],()=>r(46333));module.exports=s})();