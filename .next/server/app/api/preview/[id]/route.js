(()=>{var e={};e.id=9560,e.ids=[9560],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},33873:e=>{"use strict";e.exports=require("path")},76946:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>x,serverHooks:()=>m,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>w});var n=r(42706),o=r(28203),i=r(45994),a=r(39187),p=r(84908),u=r(88479),l=r(79748),c=r.n(l);let d=new Map,f=Date.now();async function w(e,{params:t}){if(!function(e){!function(){let e=Date.now();if(!(e-f<3e5))for(let[t,r]of(f=e,d))e>r.resetAt&&d.delete(t)}();let t=Date.now(),r=d.get(e);return!r||t>r.resetAt?(d.set(e,{count:1,resetAt:t+6e4}),!0):(r.count++,r.count<=120)}(e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown"))return a.NextResponse.json({error:"Too many requests"},{status:429});let{id:r}=await t,s=await p.z.content.findUnique({where:{id:r},select:{previewPath:!0,expiresAt:!0,mimeType:!0}});if(!s)return a.NextResponse.json({error:"Content not found"},{status:404});if(s.expiresAt&&new Date(s.expiresAt)<new Date)return a.NextResponse.json({error:"Content has expired"},{status:410});if(!s.previewPath)return a.NextResponse.json({error:"No preview available"},{status:404});try{let e=(0,u.oK)(s.previewPath),t=await c().readFile(e);return new a.NextResponse(t,{headers:{"Content-Type":"image/jpeg","Content-Length":String(t.byteLength),"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","Content-Security-Policy":"default-src 'none'","Cache-Control":"public, max-age=86400, immutable"}})}catch{return a.NextResponse.json({error:"Preview file not found on disk"},{status:404})}}let x=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/preview/[id]/route",pathname:"/api/preview/[id]",filename:"route",bundlePath:"app/api/preview/[id]/route"},resolvedPagePath:"/home/runner/work/PartFiles/PartFiles/src/app/api/preview/[id]/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:h,serverHooks:m}=x;function g(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:h})}},96487:()=>{},78335:()=>{},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},21950:(e,t,r)=>{"use strict";r.d(t,{AW:()=>d,C1:()=>c,ED:()=>p,S_:()=>f,bD:()=>l,gg:()=>o,pD:()=>i,w3:()=>a,y2:()=>u});var s=r(33873),n=r.n(s);let o=["admin","uploader","guest"],i={admin:0x80000000,uploader:524288e3,guest:0},a=0x6400000,p=168,u=1,l=5,c=new Set([".jpg",".jpeg",".png",".gif",".webp",".bmp",".ico",".tiff",".avif",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp",".txt",".csv",".rtf",".zip",".tar",".gz",".bz2",".7z",".rar",".mp3",".mp4",".wav",".ogg",".webm",".avi",".mov",".flv",".mkv",".json",".xml",".yaml",".yml",".woff",".woff2",".ttf",".otf",".eot"]),d=new Set([".html",".htm",".js",".jsx",".ts",".tsx",".svg",".php",".asp",".aspx",".jsp",".cgi",".sh",".bash",".bat",".cmd",".exe",".msi",".dll",".so",".dylib",".phtml",".phar",".htaccess",".htpasswd",".xslt"]),f=process.env.UPLOAD_DIR||n().join(process.cwd(),"uploads");if((process.env.AUTH_SECRET||process.env.NEXTAUTH_SECRET||"").length<32)throw Error("AUTH_SECRET (or NEXTAUTH_SECRET) must be set and at least 32 characters in production. Generate one with: openssl rand -base64 32")},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var s=r(96330),n=r(64981),o=r(33873),i=r.n(o);let a=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=i().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new n.C({url:e});return new s.PrismaClient({adapter:t})}()},88479:(e,t,r)=>{"use strict";r.d(t,{OJ:()=>u,Ww:()=>c,oK:()=>l});var s=r(79748),n=r.n(s),o=r(29021),i=r(33873),a=r.n(i),p=r(21950);async function u(e,t,r){let s=function(e){let t=e?a().join(p.S_,e):p.S_,r=a().resolve(t),s=a().resolve(p.S_);if(r!==s&&!r.startsWith(s+a().sep))throw Error("Path traversal detected in directory");return(0,o.existsSync)(t)||(0,o.mkdirSync)(t,{recursive:!0}),t}(r),i=a().join(s,t),u=a().resolve(i),l=a().resolve(p.S_);if(u!==l&&!u.startsWith(l+a().sep))throw Error("Path traversal detected");return await n().writeFile(i,e),a().relative(p.S_,i)}function l(e){let t=a().resolve(a().join(p.S_,e)),r=a().resolve(p.S_);if(t!==r&&!t.startsWith(r+a().sep))throw Error("Path traversal detected");return t}async function c(e){let t=l(e);try{await n().unlink(t)}catch(e){if("ENOENT"!==e.code)throw e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,9187,4981],()=>r(76946));module.exports=s})();