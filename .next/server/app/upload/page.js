(()=>{var e={};e.id=5994,e.ids=[5994],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},12773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=r(70260),s=r(28203),n=r(25155),i=r.n(n),l=r(67292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,15781)),"/home/runner/work/PartFiles/PartFiles/src/app/upload/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,69096)),"/home/runner/work/PartFiles/PartFiles/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/home/runner/work/PartFiles/PartFiles/src/app/upload/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/upload/page",pathname:"/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},75102:(e,t,r)=>{Promise.resolve().then(r.bind(r,8965)),Promise.resolve().then(r.bind(r,44994)),Promise.resolve().then(r.bind(r,87223))},15270:(e,t,r)=>{Promise.resolve().then(r.bind(r,67289)),Promise.resolve().then(r.bind(r,76641)),Promise.resolve().then(r.bind(r,57283))},24849:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(96331).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},67289:(e,t,r)=>{"use strict";r.d(t,{AdminUploadForm:()=>x});var a=r(45512),s=r(58009),n=r(39400),i=r(77722),l=r(52628),o=r(73463),d=r(64590),c=r(90288),u=r(54835),p=r(24974),m=r(91542);let f=[{value:"off",label:"Never (permanent)"},{value:"0.25",label:"15 minutes"},{value:"0.5",label:"30 minutes"},{value:"1",label:"1 hour"},{value:"6",label:"6 hours"},{value:"24",label:"1 day"},{value:"72",label:"3 days"},{value:"168",label:"7 days"}];function x(){let[e,t]=(0,s.useState)(!1),[r,x]=(0,s.useState)(""),[h,v]=(0,s.useState)(null),[g,b]=(0,s.useState)("off"),[j,y]=(0,s.useState)(""),[w,N]=(0,s.useState)([]),[k,F]=(0,s.useState)(""),[P,A]=(0,s.useState)(""),[_,C]=(0,s.useState)(0),U=(0,s.useRef)(null);async function S(e){e.preventDefault(),x(""),v(null),t(!0);try{let r=new FormData(e.currentTarget);r.set("expiry",g),j&&"__none__"!==j&&r.set("directory",j);let a=r.get("file");if(!a||0===a.size){x("Please select a file"),t(!1);return}let s=await fetch("/api/admin/upload",{method:"POST",body:r}),n=await s.json();s.ok?(v(n.content),m.oR.success("File uploaded successfully"),F(""),A(""),y(""),C(e=>e+1)):x(n.error||"Upload failed")}catch{x("An error occurred during upload")}finally{t(!1)}}return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{"aria-live":"polite","aria-atomic":"true",children:h&&(0,a.jsx)(c.Fc,{children:(0,a.jsxs)(c.TN,{children:[(0,a.jsx)("p",{className:"font-medium",children:"Upload successful!"}),(0,a.jsxs)("p",{className:"text-sm mt-1",children:["File: ",h.filename,h.directory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),"Directory: ",h.directory]}),(0,a.jsx)("br",{}),"URL:"," ",(0,a.jsxs)("a",{href:h.url,className:"text-primary underline",target:"_blank",rel:"noopener noreferrer",children:[h.url,(0,a.jsx)("span",{className:"sr-only",children:" (opens in new tab)"})]}),h.shortUrl&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),"Short URL:"," ",(0,a.jsxs)("a",{href:h.shortUrl,className:"text-primary underline",target:"_blank",rel:"noopener noreferrer",children:[h.shortUrl,(0,a.jsx)("span",{className:"sr-only",children:" (opens in new tab)"})]})]}),(0,a.jsx)("br",{}),h.expiresAt?`Expires: ${new Date(h.expiresAt).toLocaleString()}`:"Permanent (no expiry)"]})]})})}),(0,a.jsx)(d.Zp,{className:"border-primary/20",children:(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4","aria-label":"Upload file",children:[(0,a.jsx)("div",{"aria-live":"assertive","aria-atomic":"true",children:r&&(0,a.jsx)(c.Fc,{variant:"destructive",children:(0,a.jsx)(c.TN,{children:r})})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.J,{children:["File",(0,a.jsx)(p.J,{})]}),(0,a.jsx)(u.y,{inputRef:U,name:"file",required:!0,"aria-required":"true"},_)]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"filename",children:"Custom Filename"}),(0,a.jsx)(i.p,{id:"filename",name:"filename",type:"text",placeholder:"Leave blank to use original filename.",value:k,onChange:e=>F(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"shortSlug",children:"Short URL Slug"}),(0,a.jsx)(i.p,{id:"shortSlug",name:"shortSlug",type:"text",placeholder:"e.g. my-file (accessible at /s/my-file)",value:P,onChange:e=>A(e.target.value)}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Lowercase letters, numbers, and hyphens only."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{children:"Directory"}),(0,a.jsxs)(o.l6,{value:j,onValueChange:y,children:[(0,a.jsx)(o.bq,{children:(0,a.jsx)(o.yv,{placeholder:"Root (no directory)"})}),(0,a.jsxs)(o.gC,{children:[(0,a.jsx)(o.eb,{value:"__none__",children:"Root (no directory)"}),w.map(e=>(0,a.jsxs)(o.eb,{value:e.name,children:[e.name," (",e.path,")"]},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.J,{children:["Expiry",(0,a.jsx)(p.J,{})]}),(0,a.jsxs)(o.l6,{value:g,onValueChange:b,required:!0,children:[(0,a.jsx)(o.bq,{"aria-required":"true",children:(0,a.jsx)(o.yv,{placeholder:"Select expiry time"})}),(0,a.jsx)(o.gC,{children:f.map(e=>(0,a.jsx)(o.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsx)(n.$,{type:"submit",className:"w-full",disabled:e,"aria-busy":e,children:e?"Uploading...":"Upload"})]})})})]})}},54835:(e,t,r)=>{"use strict";r.d(t,{y:()=>p});var a=r(45512),s=r(58009),n=r(96331);let i=(0,n.A)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);var l=r(44269);let o=(0,n.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),d=(0,n.A)("clipboard-paste",[["path",{d:"M11 14h10",key:"1w8e9d"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v1.344",key:"1e62lh"}],["path",{d:"m17 18 4-4-4-4",key:"z2g111"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 1.793-1.113",key:"bjbb7m"}],["rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",key:"ublpy"}]]);var c=r(44195),u=r(39400);function p({inputRef:e,name:t="file",id:r,required:n,onFileChange:p}){var m;let f=(0,s.useRef)(null),x=e??f,h=(0,s.useRef)(null),[v,g]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),y=(0,s.useRef)(0);function w(){x.current?.click()}return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{ref:x,type:"file",name:t,id:r,required:n&&!b,className:"sr-only",tabIndex:-1,onChange:function(e){let t=e.target.files?.[0]??null;j(t),p?.(t)},"aria-hidden":"true"}),(0,a.jsx)("div",{ref:h,role:"button",tabIndex:0,"aria-label":b?`Selected file: ${b.name}. Click to change file, or drag and drop, or paste from clipboard.`:"Choose a file. Click to browse, drag and drop, or paste from clipboard.",onClick:w,onKeyDown:function(e){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),w())},onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),y.current++,e.dataTransfer.types.includes("Files")&&g(!0)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),y.current--,0===y.current&&g(!1)},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},onDrop:function(e){e.preventDefault(),e.stopPropagation(),y.current=0,g(!1);let t=e.dataTransfer.files?.[0];t&&function(e){let t=new DataTransfer;t.items.add(e),x.current&&(x.current.files=t.files),j(e),p?.(e)}(t)},className:(0,c.cn)("relative flex flex-col items-center justify-center gap-3 rounded-lg border-2 border-dashed px-6 py-8 transition-colors cursor-pointer","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",v?"border-primary bg-primary/5 text-primary":b?"border-primary/40 bg-primary/5":"border-muted-foreground/25 hover:border-primary/50 hover:bg-muted/50"),children:b?(0,a.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10",children:(0,a.jsx)(i,{className:"h-5 w-5 text-primary","aria-hidden":"true"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:b.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(m=b.size)<1024?`${m} B`:m<1048576?`${(m/1024).toFixed(1)} KB`:`${(m/1048576).toFixed(1)} MB`})]}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 shrink-0",onClick:e=>{e.stopPropagation(),x.current&&(x.current.value=""),j(null),p?.(null)},"aria-label":"Remove selected file",children:(0,a.jsx)(l.A,{className:"h-4 w-4","aria-hidden":"true"})})]}):(0,a.jsxs)(a.Fragment,{children:[v?(0,a.jsx)(o,{className:"h-8 w-8 text-primary animate-bounce","aria-hidden":"true"}):(0,a.jsx)(o,{className:"h-8 w-8 text-muted-foreground","aria-hidden":"true"}),(0,a.jsxs)("div",{className:"text-center space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:v?"Drop file here":"Click to browse, drag & drop"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1.5",children:[(0,a.jsx)(d,{className:"h-3 w-3","aria-hidden":"true"}),"or paste from clipboard"]})]})]})})]})}},24974:(e,t,r)=>{"use strict";r.d(t,{J:()=>s});var a=r(45512);function s(){return(0,a.jsx)("span",{"aria-hidden":"true",className:"text-destructive -ml-1.5 select-none",children:"*"})}},90288:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>l,TN:()=>o});var a=r(45512);r(58009);var s=r(21643),n=r(44195);let i=(0,s.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...r}){return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(i({variant:t}),e),...r})}function o({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...t})}},64590:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>l,Zp:()=>n,aR:()=>i});var a=r(45512);r(58009);var s=r(44195);function n({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function i({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function l({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",e),...t})}function o({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",e),...t})}function d({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",e),...t})}},77722:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var a=r(45512);r(58009);var s=r(44195);function n({className:e,type:t,...r}){return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,s.cn)("placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive","file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-3 file:text-sm file:font-medium file:cursor-pointer file:hover:bg-primary/90 file:transition-colors file:mr-3 file:-ml-3","file"===t&&"h-auto py-1.5 text-sm text-muted-foreground cursor-pointer",e),...r})}},52628:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});var a=r(45512);r(58009);var s=r(92405),n=r(44195);function i({className:e,...t}){return(0,a.jsx)(s.Root,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}},73463:(e,t,r)=>{"use strict";r.d(t,{l6:()=>c,gC:()=>m,eb:()=>f,bq:()=>p,yv:()=>u});var a=r(45512);r(58009);var s=r(96331);let n=(0,s.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var i=r(24849);let l=(0,s.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var o=r(81477),d=r(44195);function c({...e}){return(0,a.jsx)(o.Root,{"data-slot":"select",...e})}function u({...e}){return(0,a.jsx)(o.Value,{"data-slot":"select-value",...e})}function p({className:e,size:t="default",children:r,...s}){return(0,a.jsxs)(o.Trigger,{"data-slot":"select-trigger","data-size":t,className:(0,d.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...s,children:[r,(0,a.jsx)(o.Icon,{asChild:!0,children:(0,a.jsx)(n,{className:"size-4 opacity-50"})})]})}function m({className:e,children:t,position:r="item-aligned",align:s="center",...n}){return(0,a.jsx)(o.Portal,{children:(0,a.jsxs)(o.Content,{"data-slot":"select-content",className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,align:s,...n,children:[(0,a.jsx)(x,{}),(0,a.jsx)(o.Viewport,{className:(0,d.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(h,{})]})})}function f({className:e,children:t,...r}){return(0,a.jsxs)(o.Item,{"data-slot":"select-item",className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...r,children:[(0,a.jsx)("span",{"data-slot":"select-item-indicator",className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(o.ItemIndicator,{children:(0,a.jsx)(i.A,{className:"size-4"})})}),(0,a.jsx)(o.ItemText,{children:t})]})}function x({className:e,...t}){return(0,a.jsx)(o.ScrollUpButton,{"data-slot":"select-scroll-up-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,a.jsx)(l,{className:"size-4"})})}function h({className:e,...t}){return(0,a.jsx)(o.ScrollDownButton,{"data-slot":"select-scroll-down-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,a.jsx)(n,{className:"size-4"})})}},57283:(e,t,r)=>{"use strict";r.d(t,{UploadForm:()=>h});var a=r(45512),s=r(58009),n=r(39400),i=r(77722),l=r(52628),o=r(73463),d=r(64590),c=r(90288),u=r(54835),p=r(24974),m=r(91542);let f=[{value:"0.25",label:"15 minutes"},{value:"0.5",label:"30 minutes"},{value:"1",label:"1 hour"},{value:"6",label:"6 hours"},{value:"24",label:"1 day"},{value:"72",label:"3 days"},{value:"168",label:"7 days"}],x=[{value:"off",label:"Never (permanent)"},...f];function h({isAdmin:e}){let[t,r]=(0,s.useState)(!1),[h,v]=(0,s.useState)(""),[g,b]=(0,s.useState)(null),[j,y]=(0,s.useState)("1"),[w,N]=(0,s.useState)(""),[k,F]=(0,s.useState)(0),P=(0,s.useRef)(null);async function A(e){e.preventDefault(),v(""),b(null),r(!0);try{let t=new FormData(e.currentTarget);t.set("expiry",j);let a=t.get("file");if(!a||0===a.size){v("Please select a file"),r(!1);return}let s=await fetch("/api/upload",{method:"POST",body:t}),n=await s.json();s.ok?(b(n.content),m.oR.success("File uploaded successfully"),N(""),F(e=>e+1)):v(n.error||"Upload failed")}catch{v("An error occurred during upload")}finally{r(!1)}}return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{"aria-live":"polite","aria-atomic":"true",children:g&&(0,a.jsx)(c.Fc,{children:(0,a.jsxs)(c.TN,{children:[(0,a.jsx)("p",{className:"font-medium",children:"Upload successful!"}),(0,a.jsxs)("p",{className:"text-sm mt-1",children:["File: ",g.filename,(0,a.jsx)("br",{}),"URL:"," ",(0,a.jsxs)("a",{href:g.url,className:"text-primary underline",target:"_blank",rel:"noopener noreferrer",children:[g.url,(0,a.jsx)("span",{className:"sr-only",children:" (opens in new tab)"})]}),(0,a.jsx)("br",{}),g.expiresAt?`Expires: ${new Date(g.expiresAt).toLocaleString()}`:"Permanent (no expiry)"]})]})})}),(0,a.jsx)(d.Zp,{className:"border-primary/20",children:(0,a.jsx)(d.Wu,{children:(0,a.jsxs)("form",{onSubmit:A,className:"space-y-4","aria-label":"Upload file",children:[(0,a.jsx)("div",{"aria-live":"assertive","aria-atomic":"true",children:h&&(0,a.jsx)(c.Fc,{variant:"destructive",children:(0,a.jsx)(c.TN,{children:h})})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.J,{children:["File",(0,a.jsx)(p.J,{})]}),(0,a.jsx)(u.y,{inputRef:P,name:"file",required:!0,"aria-required":"true"},k)]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"filename",children:"Custom Filename"}),(0,a.jsx)(i.p,{id:"filename",name:"filename",type:"text",placeholder:"Leave blank to use original filename.",value:w,onChange:e=>N(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.J,{children:["Expiry",(0,a.jsx)(p.J,{})]}),(0,a.jsxs)(o.l6,{value:j,onValueChange:y,required:!0,children:[(0,a.jsx)(o.bq,{"aria-required":"true",children:(0,a.jsx)(o.yv,{placeholder:"Select expiry time"})}),(0,a.jsx)(o.gC,{children:(e?x:f).map(e=>(0,a.jsx)(o.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsx)(n.$,{type:"submit",className:"w-full",disabled:t,"aria-busy":t,children:t?"Uploading...":"Upload"})]})})})]})}},15781:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(62740),s=r(31831),n=r(60809),i=r(44994),l=r(87223),o=r(8965),d=r(23946);async function c(){let e=await (0,n.j2)();e?.user||(0,s.redirect)("/login"),(0,d.Yl)(e.user.role)||(0,s.redirect)("/dashboard");let t=(0,d.qc)(e.user.role);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Nav,{role:e.user.role,username:e.user.name??"Unknown"}),(0,a.jsxs)("main",{id:"main-content",className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Upload Content"}),t?(0,a.jsx)(o.AdminUploadForm,{}):(0,a.jsx)(l.UploadForm,{isAdmin:!1})]})]})}},8965:(e,t,r)=>{"use strict";r.d(t,{AdminUploadForm:()=>a});let a=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call AdminUploadForm() from the server but AdminUploadForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/PartFiles/PartFiles/src/components/admin-upload-form.tsx","AdminUploadForm")},44994:(e,t,r)=>{"use strict";r.d(t,{Nav:()=>a});let a=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call Nav() from the server but Nav is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/PartFiles/PartFiles/src/components/nav.tsx","Nav")},87223:(e,t,r)=>{"use strict";r.d(t,{UploadForm:()=>a});let a=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call UploadForm() from the server but UploadForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/PartFiles/PartFiles/src/components/upload-form.tsx","UploadForm")},60809:(e,t,r)=>{"use strict";r.d(t,{j2:()=>f,Y9:()=>u});var a=r(57971),s=r(23352),n=r(34926),i=r(84908);let l={pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e),authorized({auth:e,request:{nextUrl:t,headers:r}}){let a=e?.user?.role,s=!!e?.user&&!!a,n=t.pathname;if(n.startsWith("/login")||n.startsWith("/invite")||n.startsWith("/api/auth")||n.startsWith("/api/invite")||n.startsWith("/api/preview")||/^(\/api\/content\/[^/]+(\/raw)?)$/.test(n)||/^(\/(c|r|s|e)\/[^/]+)$/.test(n)||n.startsWith("/api/cron"))return!0;let i=function(e,t){let r=t.get("x-forwarded-host"),a=t.get("x-forwarded-proto")||"https";return r?`${a}://${r}`:e.origin}(t,r);if(!s){if(r.get("x-forwarded-host")){let e=new URL("/login",i);return e.searchParams.set("callbackUrl",t.pathname+t.search),Response.redirect(e)}return!1}return!((n.startsWith("/admin")||n.startsWith("/api/admin"))&&"admin"!==a||("/upload"===n||n.startsWith("/api/upload"))&&"admin"!==a&&"uploader"!==a)||Response.redirect(new URL("/dashboard",i))}},providers:[],session:{strategy:"jwt"}},o=new Map,d=Date.now();function c(){let e=Date.now();if(!(e-d<3e5))for(let[t,r]of(d=e,o))e>r.resetAt&&o.delete(t)}let{handlers:u,signIn:p,signOut:m,auth:f}=(0,a.Ay)({...l,callbacks:{...l.callbacks,async jwt({token:e,user:t}){if(t)return e.id=t.id,e.role=t.role,e.revalidatedAt=Date.now(),e;let r=e.revalidatedAt??0;if(Date.now()-r>3e5){let t=await i.z.user.findUnique({where:{id:e.id},select:{id:!0,role:!0}});if(!t)return e.id=void 0,e.role=void 0,e.revalidatedAt=void 0,e;e.role=t.role,e.revalidatedAt=Date.now()}return e}},providers:[(0,s.A)({name:"credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.username||!e?.password)return null;let t=e.username.toLowerCase(),r=e.password;if(function(e){c();let t=Date.now(),r=o.get(e);return!!r&&!(t>r.resetAt)&&r.failures>=5}(t))return null;let a=await i.z.user.findUnique({where:{username:t}});return a&&(0,n.Dm)(r,a.passwordHash)?(o.delete(t),{id:a.id,name:a.username,role:a.role}):(function(e){c();let t=Date.now(),r=o.get(e);!r||t>r.resetAt?o.set(e,{failures:1,resetAt:t+9e5}):(r.failures++,r.failures)}(t),null)}})]})},23946:(e,t,r)=>{"use strict";r.d(t,{Yl:()=>n,qc:()=>i});let a={guest:0,uploader:1,admin:2};function s(e,t){let r=a[e],s=a[t];return void 0!==r&&void 0!==s&&r>=s}function n(e){return s(e,"uploader")}function i(e){return s(e,"admin")}},84908:(e,t,r)=>{"use strict";r.d(t,{z:()=>l});var a=r(96330),s=r(64981),n=r(33873),i=r.n(n);let l=globalThis.prisma??function(){let e=function(){let e=process.env.DATABASE_URL||"file:./dev.db";if(e.startsWith("file:")){let t=e.slice(5),r=i().resolve(process.cwd(),t);return`file:${r}`}return e}(),t=new s.C({url:e});return new a.PrismaClient({adapter:t})}()},92405:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Label:()=>i,Root:()=>l});var a=r(58009),s=r(30830),n=r(45512),i=a.forwardRef((e,t)=>(0,n.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,9187,4981,4926,2787,5522,606,8077,6908,1477,6648,4888],()=>r(12773));module.exports=a})();