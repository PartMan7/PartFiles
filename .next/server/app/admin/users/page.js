(()=>{var e={};e.id=8733,e.ids=[8733],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},47383:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=a(70260),s=a(28203),n=a(25155),i=a.n(n),o=a(67292),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);a.d(t,l);let d=["",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,32982)),"/home/runner/work/PartFiles/PartFiles/src/app/admin/users/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,69096)),"/home/runner/work/PartFiles/PartFiles/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/home/runner/work/PartFiles/PartFiles/src/app/admin/users/page.tsx"],u={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},16467:(e,t,a)=>{Promise.resolve().then(a.bind(a,44994)),Promise.resolve().then(a.bind(a,47387))},53419:(e,t,a)=>{Promise.resolve().then(a.bind(a,76641)),Promise.resolve().then(a.bind(a,97097))},24974:(e,t,a)=>{"use strict";a.d(t,{J:()=>s});var r=a(45512);function s(){return(0,r.jsx)("span",{"aria-hidden":"true",className:"text-destructive -ml-1.5 select-none",children:"*"})}},90288:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,TN:()=>l});var r=a(45512);a(58009);var s=a(21643),n=a(44195);let i=(0,s.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function o({className:e,variant:t,...a}){return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(i({variant:t}),e),...a})}function l({className:e,...t}){return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...t})}},52628:(e,t,a)=>{"use strict";a.d(t,{J:()=>i});var r=a(45512);a(58009);var s=a(92405),n=a(44195);function i({className:e,...t}){return(0,r.jsx)(s.Root,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}},97097:(e,t,a)=>{"use strict";a.d(t,{UserManager:()=>N});var r=a(45512),s=a(58009),n=a(39400),i=a(77722),o=a(52628),l=a(73463),d=a(47630),c=a(43264),u=a(21643),p=a(55613),x=a(44195);function m({className:e,orientation:t="horizontal",...a}){return(0,r.jsx)(p.Root,{"data-slot":"tabs","data-orientation":t,orientation:t,className:(0,x.cn)("group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",e),...a})}let h=(0,u.F)("rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",{variants:{variant:{default:"bg-muted",line:"gap-1 bg-transparent"}},defaultVariants:{variant:"default"}});function v({className:e,variant:t="default",...a}){return(0,r.jsx)(p.List,{"data-slot":"tabs-list","data-variant":t,className:(0,x.cn)(h({variant:t}),e),...a})}function g({className:e,...t}){return(0,r.jsx)(p.Trigger,{"data-slot":"tabs-trigger",className:(0,x.cn)("focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent","data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground","after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",e),...t})}function f({className:e,...t}){return(0,r.jsx)(p.Content,{"data-slot":"tabs-content",className:(0,x.cn)("flex-1 outline-none",e),...t})}var j=a(78447),b=a(90288),w=a(24974),y=a(91542);function N({currentUserId:e}){let[t,a]=(0,s.useState)([]),[i,o]=(0,s.useState)(!0),[l,u]=(0,s.useState)(!1),[p,x]=(0,s.useState)(null),m=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/admin/users"),t=await e.json();a(t.users||[])}catch{y.oR.error("Failed to load users")}finally{o(!1)}},[]);async function h(e){if(confirm(`Delete user "${e.username}"? This will also delete their content.`))try{let t=await fetch(`/api/admin/users/${e.id}`,{method:"DELETE"});if(t.ok)y.oR.success(`User "${e.username}" deleted`),m();else{let e=await t.json();y.oR.error(e.error||"Failed to delete user")}}catch{y.oR.error("Failed to delete user")}}return i?(0,r.jsx)("p",{className:"text-muted-foreground",role:"status","aria-live":"polite",children:"Loading users..."}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("p",{className:"text-muted-foreground","aria-live":"polite",children:[t.length," user(s)"]}),(0,r.jsxs)(c.lG,{open:l,onOpenChange:u,children:[(0,r.jsx)(c.zM,{asChild:!0,children:(0,r.jsx)(n.$,{children:"Add User"})}),(0,r.jsxs)(c.Cf,{children:[(0,r.jsxs)(c.c7,{children:[(0,r.jsx)(c.L3,{children:"Create New User"}),(0,r.jsx)(c.rr,{children:"Add a new user to the system. Users cannot register themselves."})]}),(0,r.jsx)(C,{onSuccess:()=>{u(!1),m()}})]})]})]}),(0,r.jsxs)(d.XI,{"aria-label":"User accounts",children:[(0,r.jsx)(d.A0,{children:(0,r.jsxs)(d.Hj,{children:[(0,r.jsx)(d.nd,{children:"Username"}),(0,r.jsx)(d.nd,{children:"Role"}),(0,r.jsx)(d.nd,{children:"Content"}),(0,r.jsx)(d.nd,{children:"Created"}),(0,r.jsx)(d.nd,{className:"text-right",children:(0,r.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,r.jsx)(d.BF,{children:t.map(t=>(0,r.jsxs)(d.Hj,{children:[(0,r.jsx)(d.nA,{className:"font-medium",children:t.username}),(0,r.jsx)(d.nA,{children:(0,r.jsx)(j.E,{variant:"admin"===t.role?"default":"outline",children:t.role})}),(0,r.jsx)(d.nA,{children:t._count.content}),(0,r.jsx)(d.nA,{children:new Date(t.createdAt).toLocaleDateString()}),(0,r.jsxs)(d.nA,{className:"text-right space-x-2",children:[(0,r.jsxs)(c.lG,{open:p?.id===t.id,onOpenChange:e=>!e&&x(null),children:[(0,r.jsx)(c.zM,{asChild:!0,children:(0,r.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>x(t),children:"Edit"})}),(0,r.jsxs)(c.Cf,{children:[(0,r.jsxs)(c.c7,{children:[(0,r.jsxs)(c.L3,{children:["Edit User: ",t.username]}),(0,r.jsx)(c.rr,{children:"Update user details."})]}),(0,r.jsx)(k,{user:t,onSuccess:()=>{x(null),m()}})]})]}),t.id!==e&&(0,r.jsx)(n.$,{variant:"destructive",size:"sm",onClick:()=>h(t),children:"Delete"})]})]},t.id))})]})]})}function C({onSuccess:e}){let[t,a]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[u,p]=(0,s.useState)("guest"),[x,h]=(0,s.useState)("password"),[j,N]=(0,s.useState)(""),[C,k]=(0,s.useState)(!1);async function P(t){t.preventDefault(),a(""),c(!0),N("");let r=new FormData(t.currentTarget),s={username:r.get("username"),role:u};"invite"===x?s.invite=!0:s.password=r.get("password");try{let t=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await t.json();t.ok?"invite"===x&&r.inviteUrl?(N(r.inviteUrl),y.oR.success(`User "${r.user.username}" created with invite link`)):(y.oR.success(`User "${r.user.username}" created`),e()):a(r.error||"Failed to create user")}catch{a("An error occurred")}finally{c(!1)}}return j?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(b.Fc,{children:(0,r.jsx)(b.TN,{children:"User created! Share this one-time invite link. It expires in 48 hours."})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{children:"Invite Link"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(i.p,{value:j,readOnly:!0,className:"font-mono text-xs"}),(0,r.jsx)(n.$,{type:"button",variant:"outline",onClick:function(){navigator.clipboard.writeText(j),k(!0),y.oR.success("Invite link copied to clipboard"),setTimeout(()=>k(!1),2e3)},className:"shrink-0",children:C?"Copied!":"Copy"})]})]}),(0,r.jsx)(n.$,{className:"w-full",onClick:e,children:"Done"})]}):(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)(m,{value:x,onValueChange:e=>h(e),children:[(0,r.jsxs)(v,{className:"w-full",children:[(0,r.jsx)(g,{value:"password",className:"flex-1",children:"Set Password"}),(0,r.jsx)(g,{value:"invite",className:"flex-1",children:"Invite Link"})]}),(0,r.jsxs)("form",{onSubmit:P,className:"space-y-4 pt-4","aria-label":"Create new user",children:[(0,r.jsx)("div",{"aria-live":"assertive","aria-atomic":"true",children:t&&(0,r.jsx)(b.Fc,{variant:"destructive",children:(0,r.jsx)(b.TN,{children:t})})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(o.J,{htmlFor:"new-username",children:["Username",(0,r.jsx)(w.J,{})]}),(0,r.jsx)(i.p,{id:"new-username",name:"username",required:!0,minLength:3,maxLength:50,"aria-required":"true"})]}),(0,r.jsx)(f,{value:"password",className:"mt-0",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(o.J,{htmlFor:"new-password",children:["Password",(0,r.jsx)(w.J,{})]}),(0,r.jsx)(i.p,{id:"new-password",name:"password",type:"password",required:"password"===x,minLength:8,"aria-required":"password"===x})]})}),(0,r.jsx)(f,{value:"invite",className:"mt-0",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"A one-time link will be generated. The new user will set their own password â€” you will never see it."})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(o.J,{children:["Role",(0,r.jsx)(w.J,{})]}),(0,r.jsxs)(l.l6,{value:u,onValueChange:p,required:!0,children:[(0,r.jsx)(l.bq,{"aria-label":"Select role","aria-required":"true",children:(0,r.jsx)(l.yv,{})}),(0,r.jsxs)(l.gC,{children:[(0,r.jsx)(l.eb,{value:"guest",children:"Guest"}),(0,r.jsx)(l.eb,{value:"uploader",children:"Uploader"}),(0,r.jsx)(l.eb,{value:"admin",children:"Admin"})]})]})]}),(0,r.jsx)(n.$,{type:"submit",className:"w-full",disabled:d,"aria-busy":d,children:d?"Creating...":"invite"===x?"Create User & Generate Link":"Create User"})]})]})})}function k({user:e,onSuccess:t}){let[a,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(!1),[p,x]=(0,s.useState)(e.role);async function m(a){a.preventDefault(),d(""),u(!0);let r=new FormData(a.currentTarget),s=r.get("password"),n=r.get("username"),i={role:p};n&&n!==e.username&&(i.username=n),s&&(i.password=s);try{let a=await fetch(`/api/admin/users/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),r=await a.json();a.ok?(y.oR.success("User updated"),t()):d(r.error||"Failed to update user")}catch{d("An error occurred")}finally{u(!1)}}return(0,r.jsxs)("form",{onSubmit:m,className:"space-y-4","aria-label":`Edit user ${e.username}`,children:[(0,r.jsx)("div",{"aria-live":"assertive","aria-atomic":"true",children:a&&(0,r.jsx)(b.Fc,{variant:"destructive",children:(0,r.jsx)(b.TN,{children:a})})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{htmlFor:"edit-username",children:"Username"}),(0,r.jsx)(i.p,{id:"edit-username",name:"username",defaultValue:e.username,minLength:3,maxLength:50})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{htmlFor:"edit-password",children:"New Password"}),(0,r.jsx)(i.p,{id:"edit-password",name:"password",type:"password",minLength:8,placeholder:"Leave blank to keep current"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(o.J,{children:["Role",(0,r.jsx)(w.J,{})]}),(0,r.jsxs)(l.l6,{value:p,onValueChange:x,required:!0,children:[(0,r.jsx)(l.bq,{"aria-label":"Select role","aria-required":"true",children:(0,r.jsx)(l.yv,{})}),(0,r.jsxs)(l.gC,{children:[(0,r.jsx)(l.eb,{value:"guest",children:"Guest"}),(0,r.jsx)(l.eb,{value:"uploader",children:"Uploader"}),(0,r.jsx)(l.eb,{value:"admin",children:"Admin"})]})]})]}),(0,r.jsx)(n.$,{type:"submit",className:"w-full",disabled:c,"aria-busy":c,children:c?"Saving...":"Save Changes"})]})}},32982:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(62740),s=a(31831),n=a(60809),i=a(44994),o=a(23946),l=a(47387);async function d(){let e=await (0,n.j2)();return e?.user||(0,s.redirect)("/login"),(0,o.qc)(e.user.role)||(0,s.redirect)("/dashboard"),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Nav,{role:e.user.role,username:e.user.name??"Unknown"}),(0,r.jsxs)("main",{id:"main-content",className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"User Management"}),(0,r.jsx)(l.UserManager,{currentUserId:e.user.id})]})]})}},47387:(e,t,a)=>{"use strict";a.d(t,{UserManager:()=>r});let r=(0,a(46760).registerClientReference)(function(){throw Error("Attempted to call UserManager() from the server but UserManager is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/runner/work/PartFiles/PartFiles/src/components/user-table.tsx","UserManager")},92405:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Label:()=>i,Root:()=>o});var r=a(58009),s=a(30830),n=a(45512),i=r.forwardRef((e,t)=>(0,n.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var o=i},55613:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Content:()=>q,List:()=>T,Root:()=>U,Tabs:()=>j,TabsContent:()=>k,TabsList:()=>w,TabsTrigger:()=>N,Trigger:()=>S,createTabsScope:()=>h});var r=a(58009),s=a(31412),n=a(6004),i=a(48305),o=a(98060),l=a(30830),d=a(59018),c=a(13024),u=a(30096),p=a(45512),x="Tabs",[m,h]=(0,n.A)(x,[i.RG]),v=(0,i.RG)(),[g,f]=m(x),j=r.forwardRef((e,t)=>{let{__scopeTabs:a,value:r,onValueChange:s,defaultValue:n,orientation:i="horizontal",dir:o,activationMode:m="automatic",...h}=e,v=(0,d.jH)(o),[f,j]=(0,c.i)({prop:r,onChange:s,defaultProp:n??"",caller:x});return(0,p.jsx)(g,{scope:a,baseId:(0,u.B)(),value:f,onValueChange:j,orientation:i,dir:v,activationMode:m,children:(0,p.jsx)(l.sG.div,{dir:v,"data-orientation":i,...h,ref:t})})});j.displayName=x;var b="TabsList",w=r.forwardRef((e,t)=>{let{__scopeTabs:a,loop:r=!0,...s}=e,n=f(b,a),o=v(a);return(0,p.jsx)(i.bL,{asChild:!0,...o,orientation:n.orientation,dir:n.dir,loop:r,children:(0,p.jsx)(l.sG.div,{role:"tablist","aria-orientation":n.orientation,...s,ref:t})})});w.displayName=b;var y="TabsTrigger",N=r.forwardRef((e,t)=>{let{__scopeTabs:a,value:r,disabled:n=!1,...o}=e,d=f(y,a),c=v(a),u=P(d.baseId,r),x=F(d.baseId,r),m=r===d.value;return(0,p.jsx)(i.q7,{asChild:!0,...c,focusable:!n,active:m,children:(0,p.jsx)(l.sG.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":x,"data-state":m?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:u,...o,ref:t,onMouseDown:(0,s.mK)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(r)}),onKeyDown:(0,s.mK)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(r)}),onFocus:(0,s.mK)(e.onFocus,()=>{let e="manual"!==d.activationMode;m||n||!e||d.onValueChange(r)})})})});N.displayName=y;var C="TabsContent",k=r.forwardRef((e,t)=>{let{__scopeTabs:a,value:s,forceMount:n,children:i,...d}=e,c=f(C,a),u=P(c.baseId,s),x=F(c.baseId,s),m=s===c.value,h=r.useRef(m);return r.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,p.jsx)(o.C,{present:n||m,children:({present:a})=>(0,p.jsx)(l.sG.div,{"data-state":m?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!a,id:x,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:h.current?"0s":void 0},children:a&&i})})});function P(e,t){return`${e}-trigger-${t}`}function F(e,t){return`${e}-content-${t}`}k.displayName=C;var U=j,T=w,S=N,q=k}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,9187,4981,4926,2787,5522,606,8077,6908,1477,6648,4888,2903],()=>a(47383));module.exports=r})();